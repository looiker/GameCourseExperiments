{"version":3,"sources":["level.js"],"names":["level","cc","Class","extends","Component","properties","clickBack","Node","background","map_ui_Prefab","Prefab","tower_ALL","enemy_ALL","enemyPathNodes","default","type","enemyPrefab","IfPause","PauseInvalidButton","onLoad","map_ui","instantiate","parent","node","global","event","on","gameStart","bind","currentWaveCount","currentEnemyCount","addEnemyCurrentTime","addWaveCurrentTime","enemyNodeList","bulletNodeList","loader","loadRes","err","result","log","JSON","stringify","allLevels","json","level_1","levelConfig","addEnemy","enemy","getComponent","initWithData","push","update","dt","currentWaveConfig","dtt","count","undefined","waves","length","CreatPauseInvalidButton","pauseinvalidbutton","setSiblingIndex","ClosePauseInvalidButton","getChildByName","destroy"],"mappings":"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","file":"level.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["import global from \"./global\"\r\nvar level = cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        clickBack:cc.Node,\r\n        background:cc.Node,\r\n        map_ui_Prefab:cc.Prefab,\r\n        tower_ALL:cc.Node,\r\n        enemy_ALL:cc.Node,\r\n        enemyPathNodes: {\r\n          default: [],\r\n          type: cc.Node\r\n      },\r\n        enemyPrefab: {\r\n        default: null,\r\n        type: cc.Prefab\r\n    },\r\n        IfPause:false,\r\n        PauseInvalidButton:cc.Prefab\r\n    },\r\n\r\n    /**\r\n     * 游戏舞台初始化\r\n     */\r\n    onLoad(){\r\n        //创建关卡界面，预制件节点化\r\n        /*let pauseinvalidbutton = new cc.Node;\r\n        pauseinvalidbutton.name = \"PauseInvalidButton\";*/\r\n        let map_ui = cc.instantiate(this.map_ui_Prefab);\r\n        //添加父节点\r\n        //pauseinvalidbutton.parent = this.node;\r\n        map_ui.parent = this.node;\r\n        global.event.on(\"game_start\",this.gameStart.bind(this));\r\n        this.currentWaveCount = 0;\r\n        this.currentEnemyCount = 0;\r\n        this.addEnemyCurrentTime = 0;\r\n        this.addWaveCurrentTime = 0;\r\n        this.enemyNodeList = [];\r\n        this.bulletNodeList = [];\r\n\r\n    },\r\n    /**\r\n     * 游戏开始\r\n     */\r\n    gameStart: function () {\r\n      cc.loader.loadRes(\"./config/level_config\",  (err, result)=> {\r\n          if (err){\r\n              cc.log(\"load config \" + err);\r\n          }else {\r\n              cc.log(\"22\" + JSON.stringify(result));\r\n              let allLevels = result.json.level_1;\r\n              this.levelConfig = allLevels;\r\n          }\r\n          //let config = result[\"level_1\"];\r\n          //self.levelConfig = config;\r\n          // this.currentWaveConfig = wavesConfig[0];\r\n      });\r\n    },\r\n    //增加敌人函数\r\n    addEnemy: function (type) {\r\n    cc.log(\"add Enemy\" + this.currentEnemyCount);\r\n    cc.log(\"add Wave \" + this.currentWaveCount)\r\n    let enemy = cc.instantiate(this.enemyPrefab);\r\n    enemy.getComponent(\"enemy\").initWithData(type, this.enemyPathNodes);\r\n    enemy.parent = this.node;\r\n    this.enemyNodeList.push(enemy);\r\n    },\r\n  // 更新函数\r\n    update: function (dt) {\r\n    if (this.currentWaveConfig){\r\n        if (this.addEnemyCurrentTime > this.currentWaveConfig.dtt){\r\n            this.addEnemyCurrentTime = 0;\r\n            this.currentEnemyCount ++;\r\n            this.addEnemy(this.currentWaveConfig.type);\r\n            if (this.currentEnemyCount === this.currentWaveConfig.count){\r\n                this.currentWaveConfig = undefined;\r\n                this.currentEnemyCount = 0;\r\n            }\r\n        }\r\n        else {\r\n            this.addEnemyCurrentTime += dt;\r\n        }\r\n    }else {\r\n        if(this.levelConfig)\r\n        {\r\n            //cc.log(\"123\");\r\n            if(this.addWaveCurrentTime > this.levelConfig.dt) {\r\n            this.currentWaveConfig = this.levelConfig.waves[this.currentWaveCount];\r\n            if (this.currentWaveCount < this.levelConfig.waves.length) {\r\n                this.currentWaveCount++;\r\n            } else {\r\n                this.currentWaveConfig = undefined;\r\n            }\r\n            this.addWaveCurrentTime = 0;\r\n        } else {\r\n            this.addWaveCurrentTime += dt;\r\n        }\r\n        }else\r\n        {\r\n           // cc.log(\"456\");\r\n        }\r\n    }\r\n\r\n},\r\n\r\n    /**\r\n     * 创建阻止游戏操作的按钮\r\n     * 阻止游戏操作，停止游戏时间轴\r\n     */\r\n    CreatPauseInvalidButton:function(){\r\n        //预制件节点化\r\n        let pauseinvalidbutton = cc.instantiate(this.PauseInvalidButton);\r\n        //添加父节点、坐标\r\n        pauseinvalidbutton.parent = this.node;\r\n        pauseinvalidbutton.setSiblingIndex(3);\r\n    },\r\n\r\n    /**\r\n     * 销毁阻止游戏操作的按钮\r\n     * 开放游戏操作，继续游戏时间轴\r\n     */\r\n    ClosePauseInvalidButton:function(){\r\n        let pauseinvalidbutton = this.node.getChildByName(\"PauseInvalidButton\");\r\n        pauseinvalidbutton.destroy();\r\n    },\r\n    \r\n});\r\n\r\nexport default level"]}