{"version":3,"sources":["Tower.js"],"names":["TowerPosNodeStateP","invild","Null","Tower","BuildMenu","UpDateMenu","cc","Class","extends","Component","properties","BuildMenuPrefab","Prefab","UpdateMenuPrefab","menu","default","type","Node","TowerBasic","attack_circle","SizeOfAttack","RadiusOfAttack","state","TowerLevel","TowerType","DamageOfAttack","onLoad","constructed","IfBuildMenu","node","getChildByName","setTowerState","opacity","NUll","showBuildMenu","Tower_ALL","parent","getComponent","closeMenu","instantiate","position","showUpdateMenu"],"mappings":"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","file":"Tower.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["/**\r\n * Created by youlicc on 2019/6/14\r\n * Tower是单个塔的类，负责其中的塔的各项属性，以及塔基的点击事件\r\n * Tower具有四种状态（state）：\r\n *                  1、未建塔&无菜单  Null       1\r\n *                  2、已建塔&无菜单  Tower      2\r\n *                  3、未建塔&有菜单  BuildMenu  3\r\n *                  4、已建塔&有菜单  UpDateMenu 4\r\n * 实现以下功能：\r\n * <1>展示建造菜单\r\n * <2>销毁建造菜单\r\n * <3>展示升级/售卖菜单\r\n * <4>销毁升级/售卖菜单\r\n * 拥有以下属性：\r\n * 1、建造菜单预制件\r\n * 2、升级菜单预制件\r\n * 3、菜单节点\r\n * 4、塔基节点\r\n * 5、攻击圈\r\n * 6、攻击半径\r\n * 7、半径比例\r\n * 8、状态\r\n * 9、等级\r\n * 10、类型（箭 1 、法 2 、塔 3 、无塔 0）\r\n * 11、伤害\r\n */\r\n\r\n/**\r\n * 添加状态机\r\n */\r\nconst TowerPosNodeStateP = {\r\n\tinvild:    -1,\r\n\tNull:       1,\r\n\tTower:      2,\r\n\tBuildMenu:  3,\r\n\tUpDateMenu: 4\r\n}\r\n\r\nvar Tower = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\t\tBuildMenuPrefab:cc.Prefab,\r\n\t\tUpdateMenuPrefab:cc.Prefab,\r\n\t\tmenu:{default:null,type:cc.Node},\r\n\r\n\t\tTowerBasic:cc.Node,\r\n\t\tattack_circle:cc.Node,\r\n\t\tSizeOfAttack:1.0,\r\n\t\tRadiusOfAttack:320,\r\n\t\tstate:1,\r\n\t\tTowerLevel:0,\r\n\t\tTowerType:0,\r\n\t\tDamageOfAttack:10\r\n    },\r\n\r\n    onLoad () {\r\n\t\t//初始化塔数据\r\n\t\tthis.constructed=false;\r\n\t\tthis.IfBuildMenu=false;\r\n\r\n\t\tthis.SizeOfAttack=1.0;\r\n\t\tthis.RadiusOfAttack=320;\r\n\t\tthis.TowerLevel = 0;\r\n\t\tthis.TowerType = 0;\r\n\t\tthis.DamageOfAttack = 10;\r\n\t\tthis.TowerBasic = this.node.getChildByName(\"Towerbasic_button\");\r\n\t\tthis.setTowerState(TowerPosNodeStateP.Null);\r\n\t\tthis.attack_circle.opacity = 0;\r\n\t},\r\n\r\n\t/**\r\n\t * 为塔设置状态\r\n\t */\r\n\tsetTowerState:function(state){\r\n\t\t//如果状态重复，不重复设置\r\n\t\tif(this.state === state){\r\n\t\t\treturn\r\n\t\t}\r\n\t\t//给塔设置状态\r\n\t\tswitch(state){\r\n\t\t\tcase TowerPosNodeStateP.NUll:\r\n\t\t\t\tbreak;\r\n\t\t\tcase TowerPosNodeStateP.Tower:\r\n\t\t\t\tbreak;\r\n\t\t\tcase TowerPosNodeStateP.BuildMenu:\r\n\t\t\t\tbreak;\r\n\t\t\tcase TowerPosNodeStateP.UpDateMenu:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tthis.state=state;\r\n\t},\r\n\r\n\t/**\r\n\t * 点击塔基\r\n\t * 如果塔状态为Null,展示建造菜单,状态变为BuildMenu\r\n\t * 如果塔状态为BuildMenu，销毁建造菜单，状态变为Null\r\n\t * \r\n\t */\r\n\tshowBuildMenu:function(){\r\n\t\t//获取Tower_ALL\r\n\t\tlet Tower_ALL=this.node.parent.getComponent(\"Tower_ALL\");\r\n\t\tif(this.state === TowerPosNodeStateP.Null){\r\n\t\t\t//先销毁场上菜单\r\n\t\t\tTower_ALL.closeMenu();\r\n\t\t\t//显示攻击圈\r\n\t\t\tthis.attack_circle.opacity = 255;\r\n\t\t\t//将建造菜单预制件节点化\r\n\t\t\tlet menu = cc.instantiate(this.BuildMenuPrefab);\r\n\t\t\t//添加父节点、坐标\r\n\t\t\tmenu.parent = this.node;\r\n\t\t\tmenu.position = this.node.position;\r\n\t\t\t//添加到塔的属性中\r\n\t\t\tthis.menu = menu;\r\n\t\t\t//修改塔的状态\r\n\t\t\tthis.setTowerState(TowerPosNodeStateP.BuildMenu);\r\n\t\t}\r\n\t\telse if(this.state === TowerPosNodeStateP.BuildMenu){\r\n\t\t\t//销毁建造菜单\r\n\t\t\tTower_ALL.closeMenu();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * 点击塔基\r\n\t * 如果塔状态为Tower,展示升级菜单，状态变为UpdateMenu\r\n\t * 如果塔状态为UpdateMenu，销毁升级菜单，状态变为Tower\r\n\t */\r\n\tshowUpdateMenu:function(){\r\n\t\t//获取Tower_ALL\r\n\t\tlet Tower_ALL=this.node.parent.getComponent(\"Tower_ALL\");\r\n\t\tif(this.state === TowerPosNodeStateP.Tower){\r\n\t\t\t//先销毁场上菜单\r\n\t\t\tTower_ALL.closeMenu();\r\n\t\t\t//显示攻击圈\r\n\t\t\tthis.attack_circle.opacity = 255;\r\n\t\t\t//将升级菜单预制件节点化\r\n\t\t\tlet menu = cc.instantiate(this.UpdateMenuPrefab);\r\n\t\t\t//添加父子节点、坐标\r\n\t\t\tmenu.parent = this.node;\r\n\t\t\tmenu.position = this.node.position;\r\n\t\t\t//添加到塔的属性中\r\n\t\t\tthis.menu = menu;\r\n\t\t\t//修改塔的状态\r\n\t\t\tthis.setTowerState(TowerPosNodeStateP.UpDateMenu);\r\n\t\t}\r\n\t\telse if(this.state === TowerPosNodeStateP.UpDateMenu){\r\n\t\t\t//销毁菜单\r\n\t\t\tTower_ALL.closeMenu();\r\n\t\t}\r\n\t},\r\n\r\n});\r\n\r\nexport default Tower;\r\n"]}